# 画像比較ビュワー仕様書

## プロジェクト情報

### 基本情報
- **プロジェクト名**: Visual Compare Studio (VCS)
- **Gitリポジトリ名**: visual-compare-studio
- **パッケージ名**: @vcs/visual-compare-studio
- **バージョン**: 1.0.0
- **ライセンス**: MIT License
- **開発言語**: TypeScript, Rust
- **対応OS**: Windows, macOS, Linux

### プロジェクト概要
Visual Compare Studioは、複数の画像を効率的に比較・分析するためのデスクトップアプリケーションです。開発者、デザイナー、品質管理担当者が画像の差分を視覚的に確認し、品質評価を行うことができます。

## アーキテクチャ

### 技術スタック

#### フロントエンド
- **フレームワーク**: React 18.3+
- **ビルドツール**: Vite 5+
- **言語**: TypeScript 5.5+
- **UIフレームワーク**: Radix UI + Tailwind CSS 3.4+
- **状態管理**: Zustand 4.5+
- **画像処理**: Canvas API, WebGL

#### バックエンド
- **フレームワーク**: Tauri 2.0+
- **言語**: Rust (最新stable版)
- **画像処理**: image, imageproc クレート
- **非同期処理**: tokio

#### AI/ML
- **実行環境**: ONNX Runtime Web / TensorFlow.js Lite
- **モデル**: YOLOv5nano (物体検出), MobileNet (画像分類)
- **画像解析**: OpenCV.js (WASM版)

### ディレクトリ構造
```
visual-compare-studio/
├── src/
│   ├── components/       # Reactコンポーネント
│   ├── hooks/           # カスタムフック
│   ├── stores/          # Zustand ストア
│   ├── utils/           # ユーティリティ関数
│   ├── workers/         # Web Worker
│   └── types/           # TypeScript型定義
├── src-tauri/
│   ├── src/            # Rustソースコード
│   └── icons/          # アプリアイコン
├── public/             # 静的ファイル
├── tests/              # テストファイル
└── docs/               # ドキュメント
```

## 機能仕様

### 1. レイアウト機能

#### 1.1 表示モード
- **左右分割**: 2つの画像を左右に並べて表示
- **上下分割**: 2つの画像を上下に並べて表示
- **グリッド表示**: 2x2, 3x3の格子状に複数画像を表示
- **SwipeCompare**: スライダーで画像を重ねて比較

#### 1.2 同期機能
- ズーム操作の同期/非同期切り替え
- パン（移動）操作の同期/非同期切り替え
- スクロール位置の同期

### 2. ファイル管理機能

#### 2.1 対応ファイル形式
- 画像: JPG, JPEG, PNG, WebP, AVIF, BMP, GIF（静止画として）
- 今後対応予定: SVG, TIFF, RAW形式

#### 2.2 ファイル操作
- ドラッグ&ドロップによるファイル読み込み
- フォルダ単位での一括読み込み
- ファイル名による自動マッチング
- 履歴管理（最大50件）

#### 2.3 スマートマッチング
- 同一ファイル名での自動ペアリング
- 接頭辞・接尾辞の違いを考慮した類似度判定
- 連番ファイルの自動認識

### 3. UI/UX機能

#### 3.1 ウィンドウ構成
- **メインウィンドウ**: シングルウィンドウ構成
- **サイドバー**: ファイルエクスプローラー、サムネイルギャラリー
- **ツールバー**: レイアウト切り替え、ズーム操作
- **プロパティパネル**: 画像情報、AI分析結果
- **ステータスバー**: 座標情報、処理状況

#### 3.2 操作性
- キーボードショートカット対応
- マウスジェスチャー（ピンチズーム等）
- コンテキストメニュー
- タッチ操作対応（将来的なモバイル展開用）

### 4. AI/ML機能

#### 4.1 差分検出
- **SSIM（構造的類似性）**: 画像の構造的な差分を数値化
- **ピクセル差分**: RGB値の差分をヒートマップ表示
- **変更領域検出**: 差分が大きい領域の自動ハイライト

#### 4.2 画像解析
- **品質評価**: ブラー検出、露出評価、ノイズレベル
- **物体検出**: 基本的な物体の検出と分類
- **類似度スコア**: 0-100%での類似度表示

#### 4.3 処理性能
- Web Workerでのバックグラウンド処理
- プログレッシブレンダリング
- メモリ効率を考慮した実装

### 5. その他の機能

#### 5.1 計測ツール
- ピクセル単位での距離測定
- 角度測定
- 面積計算

#### 5.2 アノテーション
- テキストメモの追加
- 図形（矢印、四角、円）の描画
- 色指定でのマーカー機能

#### 5.3 エクスポート
- 比較結果のスクリーンショット
- 差分レポートのPDF出力
- 設定のインポート/エクスポート

## 非機能要件

### パフォーマンス要件
- 起動時間: 3秒以内
- 画像読み込み: 100MB画像を2秒以内
- メモリ使用量: 最大2GB
- 同時比較可能枚数: 最大9枚（3x3グリッド）

### セキュリティ要件
- ローカル実行のみ（ネットワーク通信なし）
- ファイルアクセス権限の適切な管理
- 一時ファイルの安全な削除

### 互換性要件
- OS: Windows 10+, macOS 11+, Ubuntu 20.04+
- 画面解像度: 最小1280x720px
- メモリ: 最小4GB RAM

## 開発スケジュール

### Phase 1: 基本機能実装（2ヶ月）
- プロジェクトセットアップ
- 基本的なUI実装
- 画像表示・比較機能

### Phase 2: AI機能実装（1.5ヶ月）
- 差分検出機能
- 画像解析機能
- パフォーマンス最適化

### Phase 3: 拡張機能実装（1.5ヶ月）
- アノテーション機能
- エクスポート機能
- UI/UXの改善

### Phase 4: テスト・リリース準備（1ヶ月）
- 統合テスト
- パフォーマンステスト
- ドキュメント整備

## 今後の拡張計画

### バージョン 1.1
- プラグインシステムの実装
- クラウドストレージ連携
- バッチ処理機能

### バージョン 2.0
- モバイルアプリ版のリリース
- リアルタイムコラボレーション機能
- 高度なAI機能（セマンティック差分検出）

## 制約事項

- 初期バージョンではローカルファイルのみ対応
- AI機能は軽量モデルに限定
- 動画ファイルは非対応
- 印刷機能は基本的なもののみ

## 用語定義

- **SwipeCompare**: スライダーを動かして2つの画像を重ねて比較する機能
- **スマートマッチング**: ファイル名の類似度から自動的にペアを作成する機能
- **SSIM**: Structural Similarity Index Measure（構造的類似性指標）
- **ヒートマップ**: 差分の大きさを色の濃淡で表現した画像